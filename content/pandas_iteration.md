Title: Efficiently iterating Pandas rows
Date: 2015-06-09 19:22
Author: nipunbatra
Category: Blog
Tags: pandas
Slug: pandas-iteration

Often in my Pandas code, I've had to iterate through the rows. The first thing which comes to mind (as would do to any one who has studied C/C++ as the first language) is to access elements by index and loop on the index. This is considered "unPythonic". For this exact same reason, for loops in Python are written as ``for a in list``. So, here's a quick comparison of two ways of iterating row-wise over a dataframe and accessing different attributes. 

	In [1]: import pandas as pd

	In [2]: import numpy as np

	In [3]: di = {k:np.random.randn(10000) for k in ["a", "b", "c", "d"]}

	In [4]: df = pd.DataFrame(di)

	In [5]: df
	Out[5]: 
	             a         b         c         d
	0    -1.924205 -0.278529 -0.261998 -0.005286
	1     0.392045  1.609994  1.733763 -1.539745
	2    -0.085711  0.756263 -0.084361 -0.424867
	3    -2.082346 -0.593061  0.758439 -0.522798
	4     1.064134  0.307272 -1.829989 -0.373749
	5    -2.428269  0.601626  1.421557 -0.451481
	6     0.926092  0.100844 -0.553302 -1.135587
	7    -0.302778 -0.064894 -0.207799  0.729668
	8     1.428392 -0.144769  0.567246 -1.119571
	9     0.619530  1.140406 -0.576779 -0.522187
	10   -0.281899 -0.375088 -1.775103 -0.618582
	11    1.773310 -0.416744  0.274547 -1.060010
	12   -1.204412 -0.999966 -0.055934 -0.275807
	13    0.438753 -1.375763  1.540492  0.902932
	14    1.259921 -1.532213 -0.092128 -0.384513
	15   -1.524382 -0.344728 -0.593565 -0.821939
	16   -0.428570 -1.054547  0.330548 -1.161294
	17   -1.281139  1.874195  0.919508 -0.497726
	18   -0.176930 -1.404015 -1.174419 -0.352054
	19    1.358412  0.443367  0.230506  1.451986
	20    0.200444  2.118015 -0.217391 -0.431538
	21    0.517777  0.201681  0.171583  0.738541
	22   -1.485768  0.449038 -1.666890 -0.287601
	23   -1.360219 -0.572025  0.758204  1.118197
	24    0.936122  0.752759 -0.584876 -0.547799
	25    0.196639 -1.954793 -0.226771 -1.471533
	26    0.797900 -0.127020 -0.725855 -0.788692
	27    0.574896 -0.225201  0.231093  0.353555
	28    0.729240 -0.204078  0.895284 -1.171200
	29   -1.267616 -0.768759 -0.013787  0.602042
	...        ...       ...       ...       ...
	9970  0.065751 -0.160771  0.399800  0.088873
	9971  1.705634 -0.555078 -0.124514 -0.123454
	9972  0.103970  0.055869  0.170443  0.337169
	9973  0.901626 -0.216274 -1.024024 -1.604295
	9974 -1.090337  1.025474 -1.060774 -0.037345
	9975 -0.321273 -0.720859 -0.189354 -0.624089
	9976 -0.967506  0.670755  2.122024  0.280750
	9977 -0.919644  1.380600 -0.547376 -0.475826
	9978  1.706442  1.236540 -1.286835 -0.374051
	9979  0.338149 -0.415665  0.200910  1.906486
	9980 -0.696541  0.725571  0.974992  1.804216
	9981 -1.400005 -0.888944  0.921454  1.564475
	9982 -0.455065 -1.656174  1.397340  1.814911
	9983 -0.938067  0.021626  0.643831 -0.565873
	9984  0.765747 -0.202373 -0.674182  0.744532
	9985 -0.088007 -1.124469 -2.031907  0.128496
	9986 -0.714295  0.032928  0.178468 -0.085715
	9987  1.025195 -0.188422 -2.095404 -0.619646
	9988  0.132227 -1.261682  0.244649 -0.666303
	9989  0.786193  1.509406 -0.202992 -1.225874
	9990  0.473791 -1.143862 -0.316002 -0.895491
	9991  0.400169  0.677086  0.924509  0.359508
	9992 -1.997034  1.188000  0.529767  3.023600
	9993  0.611606  0.870376  0.111409  0.791074
	9994 -0.139214  1.621675 -1.175538 -1.434139
	9995 -1.114247 -0.242445  0.863734 -0.562891
	9996  0.236475  1.685572  0.372954 -0.154444
	9997  0.382693  0.246771  0.452163 -0.418974
	9998 -1.135619 -2.219971  0.365980  0.334584
	9999  0.200453  0.638034 -0.827149 -0.516329

	[10000 rows x 4 columns]

	In [6]: df.head()
	Out[6]: 
	          a         b         c         d
	0 -1.924205 -0.278529 -0.261998 -0.005286
	1  0.392045  1.609994  1.733763 -1.539745
	2 -0.085711  0.756263 -0.084361 -0.424867
	3 -2.082346 -0.593061  0.758439 -0.522798
	4  1.064134  0.307272 -1.829989 -0.373749

	In [7]: %%timeit
	   ...: for idx in df.index:
	   ...:     df.ix[idx]['a'], idx
	   ...: 
	1 loops, best of 3: 849 ms per loop

	In [8]: %%timeit
	for index, row in df.iterrows():
	    row['a'], index
	   ...: 
	1 loops, best of 3: 224 ms per loop

We can see that the "Pythonic" way of doing this is about 4 times quicker and looks more clear. Thus, the recommended way is to use

	for index, row in df.iterrows():
		row['a'], index

It should be noted that this is similar in syntax to the `enumerate` syntax we are used to seeing in iteration over Python lists.